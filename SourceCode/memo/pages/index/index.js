"use strict";
Page({
    data: {
        isListMode: false,
        isNullData: true,
        memoListData: [],
        pageSize: 20,
        count: 0,
        startX: 0,
        startY: 0
    },
    touchStartTime: 0,
    touchEndTime: 0,
    onPullDownRefresh: function () {
        var that = this;
        wx.stopPullDownRefresh({
            success: function () {
                that.data.count = 0;
                that.setData({
                    count: that.data.count
                });
                that.getMemoListData();
            }
        });
    },
    onReachBottom: function () {
        var memoListData = wx.getStorageSync('memoListData');
        if (memoListData != null) {
            if (this.data.count == Math.ceil(memoListData.length / this.data.pageSize)) {
                wx.showToast({
                    title: '没有更多数据了！',
                    icon: 'none',
                    duration: 1500
                });
            }
            else {
                this.data.count++;
                this.getMemoListData();
            }
        }
    },
    onShow: function () {
        try {
            this.data.count = 0;
            this.setData({
                count: this.data.count
            });
            this.getMemoListData();
            wx.setStorageSync('isEdit', false);
        }
        catch (e) { }
    },
    onLoad: function () {
        this.data.count = 0;
        this.setData({
            count: this.data.count
        });
        this.getMemoListData();
    },
    getMemoListData: function () {
        try {
            var memoListData = wx.getStorageSync('memoListData');
            if (memoListData) {
                memoListData.forEach(function (item) {
                    item.isTouchMove = false;
                });
                var memoListDataTemp = [];
                var total = memoListData.length;
                var pageNum = (this.data.count + 1) * this.data.pageSize;
                if (pageNum > total) {
                    pageNum = total;
                    this.data.count = Math.ceil(total / this.data.pageSize);
                }
                for (var i = 0; i < pageNum; i++) {
                    memoListDataTemp.push(memoListData[i]);
                }
                this.setData({
                    count: this.data.count,
                    memoListData: memoListDataTemp,
                    isNullData: false
                });
            }
            else {
                this.setData({
                    memoListData: [],
                    isNullData: true
                });
            }
        }
        catch (e) {
            wx.showToast({
                title: '获取备忘录数据失败，请稍后再试！',
                icon: 'none',
                duration: 1500
            });
        }
    },
    touchStart: function (event) {
        this.touchStartTime = event.timeStamp;
    },
    touchEnd: function (event) {
        this.touchEndTime = event.timeStamp;
    },
    onClickNew: function () {
        try {
            wx.setStorageSync('isEdit', false);
            wx.switchTab({
                url: '/pages/new/new'
            });
        }
        catch (e) { }
    },
    onClickEdit: function (event) {
        if (this.touchEndTime - this.touchStartTime < 350) {
            try {
                wx.setStorageSync('isEdit', true);
                var id = event.currentTarget.dataset.item.id;
                wx.setStorageSync('id', id);
                wx.switchTab({
                    url: '/pages/new/new'
                });
            }
            catch (e) { }
        }
    },
    onClickLongDelete: function (event) {
        this.onClickdeleteModal(event);
    },
    onClickdeleteModal: function (event) {
        var that = this;
        wx.showModal({
            title: '删除提示',
            content: '是否确定删除该备忘录！',
            success: function (res) {
                if (res.confirm) {
                    that.onClickdelete(event);
                }
                else if (res.cancel) {
                }
            }
        });
    },
    onClickdelete: function (event) {
        try {
            var index = event.currentTarget.dataset.index;
            if (index != null && this.data.memoListData != null) {
                this.data.memoListData.splice(event.currentTarget.dataset.index, 1);
                this.setData({
                    memoListData: this.data.memoListData
                });
                wx.setStorageSync('memoListData', this.data.memoListData);
                if (this.data.memoListData.length == 0) {
                    wx.clearStorageSync();
                }
                wx.showToast({
                    title: '删除成功',
                    icon: 'success',
                    duration: 1000
                });
            }
        }
        catch (e) { }
    },
    onClickToggleMode: function () {
        this.data.isListMode = !this.data.isListMode;
        this.setData({
            isListMode: this.data.isListMode
        });
    },
    touchstart: function (event) {
        this.data.memoListData.forEach(function (item) {
            if (item.isTouchMove)
                item.isTouchMove = false;
        });
        this.setData({
            memoListData: this.data.memoListData,
            startX: event.changedTouches[0].clientX,
            startY: event.changedTouches[0].clientY
        });
    },
    touchmove: function (event) {
        var that = this, index = event.currentTarget.dataset.index, startX = that.data.startX, startY = that.data.startY, touchMoveX = event.changedTouches[0].clientX, touchMoveY = event.changedTouches[0].clientY, angle = that.angle({ X: startX, Y: startY }, { X: touchMoveX, Y: touchMoveY });
        that.data.memoListData.forEach(function (v, i) {
            v.isTouchMove = false;
            if (Math.abs(angle) > 30)
                return;
            if (i == index) {
                if (touchMoveX > startX)
                    v.isTouchMove = false;
                else
                    v.isTouchMove = true;
            }
        });
        that.setData({
            memoListData: that.data.memoListData
        });
    },
    angle: function (start, end) {
        var _X = end.X - start.X, _Y = end.Y - start.Y;
        return 360 * Math.atan(_Y / _X) / (2 * Math.PI);
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBRUEsSUFBSSxDQUFDO0lBQ0gsSUFBSSxFQUFFO1FBQ0osVUFBVSxFQUFFLEtBQUs7UUFDakIsVUFBVSxFQUFFLElBQUk7UUFDaEIsWUFBWSxFQUFFLEVBQVc7UUFDekIsUUFBUSxFQUFFLEVBQUU7UUFDWixLQUFLLEVBQUUsQ0FBQztRQUVSLE1BQU0sRUFBRSxDQUFXO1FBQ25CLE1BQU0sRUFBRSxDQUFXO0tBQ3BCO0lBR0QsY0FBYyxFQUFFLENBQUM7SUFFakIsWUFBWSxFQUFFLENBQUM7SUFLZixpQkFBaUI7UUFDZixJQUFJLElBQUksR0FBRyxJQUFJLENBQUM7UUFDaEIsRUFBRSxDQUFDLG1CQUFtQixDQUFDO1lBQ3JCLE9BQU87Z0JBQ0wsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDO2dCQUNwQixJQUFJLENBQUMsT0FBUSxDQUFDO29CQUNaLEtBQUssRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUs7aUJBQ3ZCLENBQUMsQ0FBQztnQkFDSCxJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7WUFDekIsQ0FBQztTQUNGLENBQUMsQ0FBQztJQUNMLENBQUM7SUFLRCxhQUFhO1FBQ1gsSUFBSSxZQUFZLEdBQUcsRUFBRSxDQUFDLGNBQWMsQ0FBQyxjQUFjLENBQUMsQ0FBQztRQUNyRCxJQUFJLFlBQVksSUFBSSxJQUFJLEVBQUU7WUFDeEIsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRTtnQkFDMUUsRUFBRSxDQUFDLFNBQVMsQ0FBQztvQkFDWCxLQUFLLEVBQUUsVUFBVTtvQkFDakIsSUFBSSxFQUFFLE1BQU07b0JBQ1osUUFBUSxFQUFFLElBQUk7aUJB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QU87WUFDakMsSUFBSSxDQUFDLElBQUksS0FBSyxFQUFFO2dCQUNkLElBQUksVUFBVSxHQUFHLE1BQU07b0JBQ3JCLENBQUMsQ0FBQyxXQUFXLEdBQUcsS0FBSyxDQUFBOztvQkFFckIsQ0FBQyxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUE7YUFDdkI7UUFDSCxDQUFDLENBQUMsQ0FBQztRQUVILElBQUksQ0FBQyxPQUFRLENBQUM7WUFDWixZQUFZLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZO1NBQ3JDLENBQUMsQ0FBQTtJQUNKLENBQUM7SUFLRCxLQUFLLFlBQUMsS0FBVSxFQUFFLEdBQVE7UUFDeEIsSUFBSSxFQUFFLEdBQUcsR0FBRyxDQUFDLENBQUMsR0FBRyxLQUFLLENBQUMsQ0FBQyxFQUFFLEVBQUUsR0FBRyxHQUFHLENBQUMsQ0FBQyxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUE7UUFFOUMsT0FBTyxHQUFHLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ2xELENBQUM7Q0FFRixDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvL2luZGV4LmpzXG5cblBhZ2Uoe1xuICBkYXRhOiB7XG4gICAgaXNMaXN0TW9kZTogZmFsc2UsXG4gICAgaXNOdWxsRGF0YTogdHJ1ZSxcbiAgICBtZW1vTGlzdERhdGE6IFtdIGFzIGFueVtdLFxuICAgIHBhZ2VTaXplOiAyMCxcbiAgICBjb3VudDogMCxcbiAgICAvL+W8gOWni+WdkOagh1xuICAgIHN0YXJ0WDogMCBhcyBudW1iZXIsXG4gICAgc3RhcnRZOiAwIGFzIG51bWJlclxuICB9LFxuXG4gIC8vIOinpuaRuOW8gOWni+aXtumXtFxuICB0b3VjaFN0YXJ0VGltZTogMCxcbiAgLy8g6Kem5pG457uT5p2f5pe26Ze0XG4gIHRvdWNoRW5kVGltZTogMCxcblxuICAvKipcbiAgICog6aG16Z2i55u45YWz5LqL5Lu25aSE55CG5Ye95pWwLS3nm5HlkKznlKjmiLfkuIvmi4nliqjkvZxcbiAgICovXG4gIG9uUHVsbERvd25SZWZyZXNoKCkge1xuICAgIGxldCB0aGF0ID0gdGhpcztcbiAgICB3eC5zdG9wUHVsbERvd25SZWZyZXNoKHtcbiAgICAgIHN1Y2Nlc3MoKSB7XG4gICAgICAgIHRoYXQuZGF0YS5jb3VudCA9IDA7XG4gICAgICAgIHRoYXQuc2V0RGF0YSEoe1xuICAgICAgICAgIGNvdW50OiB0aGF0LmRhdGEuY291bnRcbiAgICAgICAgfSk7XG4gICAgICAgIHRoYXQuZ2V0TWVtb0xpc3REYXRhKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIOmhtemdouS4iuaLieinpuW6leS6i+S7tueahOWkhOeQhuWHveaVsFxuICAgKi9cbiAgb25SZWFjaEJvdHRvbSgpIHtcbiAgICBsZXQgbWVtb0xpc3REYXRhID0gd3guZ2V0U3RvcmFnZVN5bmMoJ21lbW9MaXN0RGF0YScpO1xuICAgIGlmIChtZW1vTGlzdERhdGEgIT0gbnVsbCkge1xuICAgICAgaWYgKHRoaXMuZGF0YS5jb3VudCA9PSBNYXRoLmNlaWwobWVtb0xpc3REYXRhLmxlbmd0aCAvIHRoaXMuZGF0YS5wYWdlU2l6ZSkpIHtcbiAgICAgICAgd3guc2hvd1RvYXN0KHtcbiAgICAgICAgICB0aXRsZTogJ+ayoeacieabtOWkmuaVsOaNruS6hu+8gScsXG4gICAgICAgICAgaWNvbjogJ25vbmUnLFxuICAgICAgICAgIGR1cmF0aW9uOiAxNTAwXG4gICAgICAgIH0pXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmRhdGEuY291bnQrKztcbiAgICAgICAgdGhpcy5nZXRNZW1vTGlzdERhdGEoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgfSxcblxuICAvKipcbiAgICog55Sf5ZG95ZGo5pyf5Ye95pWwLS3nm5HlkKzpobXpnaLmmL7npLpcbiAgICovXG4gIG9uU2hvdygpIHtcbiAgICB0cnkge1xuICAgICAgdGhpcy5kYXRhLmNvdW50ID0gMDtcbiAgICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgICBjb3VudDogdGhpcy5kYXRhLmNvdW50XG4gICAgICB9KTtcbiAgICAgIHRoaXMuZ2V0TWVtb0xpc3REYXRhKCk7XG4gICAgICAvLyDorr7nva7nvJbovpHnirbmgIFcbiAgICAgIHd4LnNldFN0b3JhZ2VTeW5jKCdpc0VkaXQnLCBmYWxzZSlcbiAgICB9IGNhdGNoIChlKSB7IH1cbiAgfSxcblxuICBvbkxvYWQoKSB7XG4gICAgdGhpcy5kYXRhLmNvdW50ID0gMDtcbiAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgIGNvdW50OiB0aGlzLmRhdGEuY291bnRcbiAgICB9KTtcbiAgICB0aGlzLmdldE1lbW9MaXN0RGF0YSgpO1xuICB9LFxuXG4gIC8qKlxuICAgKiDojrflj5blpIflv5jlvZXmlbDmja7mupBcbiAgICovXG4gIGdldE1lbW9MaXN0RGF0YSgpIHtcbiAgICAvLyDojrflj5bmnKzlnLDnvJPlrZjlpIflv5jlvZXliJfooajmlbDmja5cbiAgICB0cnkge1xuICAgICAgbGV0IG1lbW9MaXN0RGF0YSA9IHd4LmdldFN0b3JhZ2VTeW5jKCdtZW1vTGlzdERhdGEnKTtcbiAgICAgIGlmIChtZW1vTGlzdERhdGEpIHtcbiAgICAgICAgbWVtb0xpc3REYXRhLmZvckVhY2goKGl0ZW06IGFueSkgPT4ge1xuICAgICAgICAgIC8v6buY6K6k6ZqQ6JeP5Yig6ZmkXG4gICAgICAgICAgaXRlbS5pc1RvdWNoTW92ZSA9IGZhbHNlO1xuICAgICAgICB9KTtcbiAgICAgICAgLy8g5YiG6aG1XG4gICAgICAgIGxldCBtZW1vTGlzdERhdGFUZW1wOiBhbnlbXSA9IFtdO1xuICAgICAgICBsZXQgdG90YWwgPSBtZW1vTGlzdERhdGEubGVuZ3RoO1xuICAgICAgICBsZXQgcGFnZU51bSA9ICh0aGlzLmRhdGEuY291bnQgKyAxKSAqIHRoaXMuZGF0YS5wYWdlU2l6ZTtcbiAgICAgICAgaWYgKHBhZ2VOdW0gPiB0b3RhbCkge1xuICAgICAgICAgIHBhZ2VOdW0gPSB0b3RhbDtcbiAgICAgICAgICB0aGlzLmRhdGEuY291bnQgPSBNYXRoLmNlaWwodG90YWwgLyB0aGlzLmRhdGEucGFnZVNpemUpO1xuICAgICAgICB9XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGFnZU51bTsgaSsrKSB7XG4gICAgICAgICAgbWVtb0xpc3REYXRhVGVtcC5wdXNoKG1lbW9MaXN0RGF0YVtpXSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zZXREYXRhISh7XG4gICAgICAgICAgY291bnQ6IHRoaXMuZGF0YS5jb3VudCxcbiAgICAgICAgICBtZW1vTGlzdERhdGE6IG1lbW9MaXN0RGF0YVRlbXAsXG4gICAgICAgICAgaXNOdWxsRGF0YTogZmFsc2VcbiAgICAgICAgfSlcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgICAgIG1lbW9MaXN0RGF0YTogW10gYXMgYW55LFxuICAgICAgICAgIGlzTnVsbERhdGE6IHRydWVcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICB3eC5zaG93VG9hc3Qoe1xuICAgICAgICB0aXRsZTogJ+iOt+WPluWkh+W/mOW9leaVsOaNruWksei0pe+8jOivt+eojeWQjuWGjeivle+8gScsXG4gICAgICAgIGljb246ICdub25lJyxcbiAgICAgICAgZHVyYXRpb246IDE1MDBcbiAgICAgIH0pXG4gICAgfVxuICB9LFxuXG4gIC8qKlxuICAgKiDmjInpkq7op6bmkbjlvIDlp4vop6blj5HnmoTkuovku7ZcbiAgICovXG4gIHRvdWNoU3RhcnQoZXZlbnQ6IGFueSkge1xuICAgIHRoaXMudG91Y2hTdGFydFRpbWUgPSBldmVudC50aW1lU3RhbXBcbiAgfSxcblxuICAvKipcbiAgICog5oyJ6ZKu6Kem5pG457uT5p2f6Kem5Y+R55qE5LqL5Lu2XG4gICAqL1xuICB0b3VjaEVuZChldmVudDogYW55KSB7XG4gICAgdGhpcy50b3VjaEVuZFRpbWUgPSBldmVudC50aW1lU3RhbXBcbiAgfSxcblxuICAvKipcbiAgICog54K55Ye75paw5bu6XG4gICAqL1xuICBvbkNsaWNrTmV3KCkge1xuICAgIHRyeSB7XG4gICAgICAvLyDorr7nva7nvJbovpHnirbmgIFcbiAgICAgIHd4LnNldFN0b3JhZ2VTeW5jKCdpc0VkaXQnLCBmYWxzZSlcbiAgICAgIC8vIOWIh+aNouWIsOaWsOW7ulxuICAgICAgd3guc3dpdGNoVGFiKHtcbiAgICAgICAgdXJsOiAnL3BhZ2VzL25ldy9uZXcnXG4gICAgICB9KVxuICAgIH0gY2F0Y2ggKGUpIHsgfVxuICB9LFxuXG4gIC8qKlxuICAgKiDngrnlh7vnvJbovpFcbiAgICovXG4gIG9uQ2xpY2tFZGl0KGV2ZW50OiBhbnkpIHtcbiAgICAvLyDmjqfliLbngrnlh7vkuovku7blnKgzNTBtc+WGheinpuWPke+8jOWKoOi/meWxguWIpOaWreaYr+S4uuS6humYsuatoumVv+aMieaXtuS8muinpuWPkeeCueWHu+S6i+S7tlxuICAgIGlmICh0aGlzLnRvdWNoRW5kVGltZSAtIHRoaXMudG91Y2hTdGFydFRpbWUgPCAzNTApIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIC8vIOiuvue9rue8lui+keeKtuaAgVxuICAgICAgICB3eC5zZXRTdG9yYWdlU3luYygnaXNFZGl0JywgdHJ1ZSlcbiAgICAgICAgbGV0IGlkID0gZXZlbnQuY3VycmVudFRhcmdldC5kYXRhc2V0Lml0ZW0uaWQ7XG4gICAgICAgIC8vIOiuvue9rklkXG4gICAgICAgIHd4LnNldFN0b3JhZ2VTeW5jKCdpZCcsIGlkKVxuICAgICAgICAvLyDliIfmjaLliLDmlrDlu7pcbiAgICAgICAgd3guc3dpdGNoVGFiKHtcbiAgICAgICAgICB1cmw6ICcvcGFnZXMvbmV3L25ldydcbiAgICAgICAgfSlcbiAgICAgIH0gY2F0Y2ggKGUpIHsgfVxuICAgIH1cbiAgfSxcblxuICBvbkNsaWNrTG9uZ0RlbGV0ZShldmVudDogYW55KSB7XG4gICAgdGhpcy5vbkNsaWNrZGVsZXRlTW9kYWwoZXZlbnQpO1xuICB9LFxuXG4gIC8qKlxuICAgKiDliKDpmaTmj5DnpLpcbiAgICovXG4gIG9uQ2xpY2tkZWxldGVNb2RhbChldmVudDogYW55KSB7XG4gICAgbGV0IHRoYXQgPSB0aGlzO1xuICAgIHd4LnNob3dNb2RhbCh7XG4gICAgICB0aXRsZTogJ+WIoOmZpOaPkOekuicsXG4gICAgICBjb250ZW50OiAn5piv5ZCm56Gu5a6a5Yig6Zmk6K+l5aSH5b+Y5b2V77yBJyxcbiAgICAgIHN1Y2Nlc3MocmVzKSB7XG4gICAgICAgIGlmIChyZXMuY29uZmlybSkge1xuICAgICAgICAgIHRoYXQub25DbGlja2RlbGV0ZShldmVudCk7XG4gICAgICAgIH0gZWxzZSBpZiAocmVzLmNhbmNlbCkge1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSlcbiAgfSxcblxuICAvKipcbiAgICog54K55Ye75Yig6ZmkXG4gICAqL1xuICBvbkNsaWNrZGVsZXRlKGV2ZW50OiBhbnkpIHtcbiAgICB0cnkge1xuICAgICAgbGV0IGluZGV4OiBudW1iZXIgPSBldmVudC5jdXJyZW50VGFyZ2V0LmRhdGFzZXQuaW5kZXg7XG4gICAgICBpZiAoaW5kZXggIT0gbnVsbCAmJiB0aGlzLmRhdGEubWVtb0xpc3REYXRhICE9IG51bGwpIHtcbiAgICAgICAgdGhpcy5kYXRhLm1lbW9MaXN0RGF0YS5zcGxpY2UoZXZlbnQuY3VycmVudFRhcmdldC5kYXRhc2V0LmluZGV4LCAxKTtcbiAgICAgICAgdGhpcy5zZXREYXRhISh7XG4gICAgICAgICAgbWVtb0xpc3REYXRhOiB0aGlzLmRhdGEubWVtb0xpc3REYXRhXG4gICAgICAgIH0pXG4gICAgICAgIC8v5byC5q2l5pu05paw5YiX6KGo57yT5a2YXG4gICAgICAgIHd4LnNldFN0b3JhZ2VTeW5jKCdtZW1vTGlzdERhdGEnLCB0aGlzLmRhdGEubWVtb0xpc3REYXRhKTtcbiAgICAgICAgaWYgKHRoaXMuZGF0YS5tZW1vTGlzdERhdGEubGVuZ3RoID09IDApIHtcbiAgICAgICAgICB3eC5jbGVhclN0b3JhZ2VTeW5jKCk7XG4gICAgICAgIH1cbiAgICAgICAgd3guc2hvd1RvYXN0KHtcbiAgICAgICAgICB0aXRsZTogJ+WIoOmZpOaIkOWKnycsXG4gICAgICAgICAgaWNvbjogJ3N1Y2Nlc3MnLFxuICAgICAgICAgIGR1cmF0aW9uOiAxMDAwXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGUpIHsgfVxuICB9LFxuXG4gIC8qKlxuICAgKiDliIfmjaLmqKHlvI9cbiAgICovXG4gIG9uQ2xpY2tUb2dnbGVNb2RlKCkge1xuICAgIHRoaXMuZGF0YS5pc0xpc3RNb2RlID0gIXRoaXMuZGF0YS5pc0xpc3RNb2RlO1xuICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgaXNMaXN0TW9kZTogdGhpcy5kYXRhLmlzTGlzdE1vZGVcbiAgICB9KTtcbiAgfSxcblxuICAvKipcbiAgICog5omL5oyH6Kem5pG45Yqo5L2c5byA5aeLIOiusOW9lei1t+eCuVjlnZDmoIdcbiAgICovXG4gIHRvdWNoc3RhcnQoZXZlbnQ6IGFueSkge1xuICAgIC8v5byA5aeL6Kem5pG45pe2IOmHjee9ruaJgOacieWIoOmZpFxuICAgIHRoaXMuZGF0YS5tZW1vTGlzdERhdGEuZm9yRWFjaCgoaXRlbTogYW55KSA9PiB7XG4gICAgICAvL+WPquaTjeS9nOS4unRydWXnmoRcbiAgICAgIGlmIChpdGVtLmlzVG91Y2hNb3ZlKVxuICAgICAgICBpdGVtLmlzVG91Y2hNb3ZlID0gZmFsc2U7XG4gICAgfSk7XG4gICAgLy/mm7TmlrDmlbDmja5cbiAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgIG1lbW9MaXN0RGF0YTogdGhpcy5kYXRhLm1lbW9MaXN0RGF0YSxcbiAgICAgIHN0YXJ0WDogZXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0uY2xpZW50WCxcbiAgICAgIHN0YXJ0WTogZXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0uY2xpZW50WVxuICAgIH0pXG4gIH0sXG5cbiAgLyoqXG4gICAqIOa7keWKqOS6i+S7tuWkhOeQhlxuICAgKi9cbiAgdG91Y2htb3ZlKGV2ZW50OiBhbnkpIHtcbiAgICBsZXQgdGhhdCA9IHRoaXMsXG4gICAgICBpbmRleCA9IGV2ZW50LmN1cnJlbnRUYXJnZXQuZGF0YXNldC5pbmRleCwvL+W9k+WJjee0ouW8lVxuICAgICAgc3RhcnRYID0gdGhhdC5kYXRhLnN0YXJ0WCwvL+W8gOWni1jlnZDmoIdcbiAgICAgIHN0YXJ0WSA9IHRoYXQuZGF0YS5zdGFydFksLy/lvIDlp4tZ5Z2Q5qCHXG4gICAgICB0b3VjaE1vdmVYID0gZXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0uY2xpZW50WCwvL+a7keWKqOWPmOWMluWdkOagh1xuICAgICAgdG91Y2hNb3ZlWSA9IGV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLmNsaWVudFksLy/mu5Hliqjlj5jljJblnZDmoIdcbiAgICAgIC8v6I635Y+W5ruR5Yqo6KeS5bqmXG4gICAgICBhbmdsZSA9IHRoYXQuYW5nbGUoeyBYOiBzdGFydFgsIFk6IHN0YXJ0WSB9LCB7IFg6IHRvdWNoTW92ZVgsIFk6IHRvdWNoTW92ZVkgfSk7XG5cbiAgICB0aGF0LmRhdGEubWVtb0xpc3REYXRhLmZvckVhY2goKHY6IGFueSwgaTogbnVtYmVyKSA9PiB7XG4gICAgICB2LmlzVG91Y2hNb3ZlID0gZmFsc2VcbiAgICAgIC8v5ruR5Yqo6LaF6L+HMzDluqbop5IgcmV0dXJuXG4gICAgICBpZiAoTWF0aC5hYnMoYW5nbGUpID4gMzApIHJldHVybjtcbiAgICAgIGlmIChpID09IGluZGV4KSB7XG4gICAgICAgIGlmICh0b3VjaE1vdmVYID4gc3RhcnRYKSAvL+WPs+a7kVxuICAgICAgICAgIHYuaXNUb3VjaE1vdmUgPSBmYWxzZVxuICAgICAgICBlbHNlIC8v5bem5ruRXG4gICAgICAgICAgdi5pc1RvdWNoTW92ZSA9IHRydWVcbiAgICAgIH1cbiAgICB9KTtcbiAgICAvL+abtOaWsOaVsOaNrlxuICAgIHRoYXQuc2V0RGF0YSEoe1xuICAgICAgbWVtb0xpc3REYXRhOiB0aGF0LmRhdGEubWVtb0xpc3REYXRhXG4gICAgfSlcbiAgfSxcblxuICAvKipcbiAgICog6K6h566X5ruR5Yqo6KeS5bqmXG4gICAqL1xuICBhbmdsZShzdGFydDogYW55LCBlbmQ6IGFueSkge1xuICAgIGxldCBfWCA9IGVuZC5YIC0gc3RhcnQuWCwgX1kgPSBlbmQuWSAtIHN0YXJ0LllcbiAgICAvL+i/lOWbnuinkuW6piBNYXRoLmF0YW4oKei/lOWbnuaVsOWtl+eahOWPjeato+WIh+WAvFxuICAgIHJldHVybiAzNjAgKiBNYXRoLmF0YW4oX1kgLyBfWCkgLyAoMiAqIE1hdGguUEkpO1xuICB9XG5cbn0pXG4iXX0=