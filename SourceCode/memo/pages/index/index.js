"use strict";
Page({
    data: {
        isNullData: true,
        memoListData: [],
        pageSize: 20,
        count: 0,
        startX: 0,
        startY: 0
    },
    onPullDownRefresh: function () {
        var that = this;
        wx.stopPullDownRefresh({
            success: function () {
                that.data.count = 0;
                that.setData({
                    count: that.data.count
                });
                that.getMemoListData();
            }
        });
    },
    onReachBottom: function () {
        var memoListData = wx.getStorageSync('memoListData');
        if (memoListData != null) {
            if (this.data.count == Math.ceil(memoListData.length / this.data.pageSize)) {
                wx.showToast({
                    title: '没有更多数据了！',
                    icon: 'none',
                    duration: 1500
                });
            }
            else {
                this.data.count++;
                this.getMemoListData();
            }
        }
    },
    onShow: function () {
        try {
            this.data.count = 0;
            this.setData({
                count: this.data.count
            });
            this.getMemoListData();
            wx.setStorageSync('isEdit', false);
        }
        catch (e) { }
    },
    onLoad: function () {
        this.data.count = 0;
        this.setData({
            count: this.data.count
        });
        this.getMemoListData();
    },
    getMemoListData: function () {
        try {
            var memoListData = wx.getStorageSync('memoListData');
            if (memoListData) {
                memoListData.forEach(function (item) {
                    item.isTouchMove = false;
                });
                var memoListDataTemp = [];
                var total = memoListData.length;
                var pageNum = (this.data.count + 1) * this.data.pageSize;
                if (pageNum > total) {
                    pageNum = total;
                    this.data.count = Math.ceil(total / this.data.pageSize);
                }
                for (var i = 0; i < pageNum; i++) {
                    memoListDataTemp.push(memoListData[i]);
                }
                this.setData({
                    count: this.data.count,
                    memoListData: memoListDataTemp,
                    isNullData: false
                });
            }
            else {
                this.setData({
                    memoListData: [],
                    isNullData: true
                });
            }
        }
        catch (e) {
            wx.showToast({
                title: '获取备忘录数据失败，请稍后再试！',
                icon: 'none',
                duration: 1500
            });
        }
    },
    onClickNew: function () {
        try {
            wx.setStorageSync('isEdit', false);
            wx.switchTab({
                url: '/pages/new/new'
            });
        }
        catch (e) { }
    },
    onClickEdit: function (event) {
        try {
            wx.setStorageSync('isEdit', true);
            var id = event.currentTarget.dataset.item.id;
            wx.setStorageSync('id', id);
            wx.switchTab({
                url: '/pages/new/new'
            });
        }
        catch (e) { }
    },
    onClickdeleteModal: function (event) {
        var that = this;
        wx.showModal({
            title: '删除提示',
            content: '是否确定删除该备忘录！',
            success: function (res) {
                if (res.confirm) {
                    that.onClickdelete(event);
                }
                else if (res.cancel) {
                }
            }
        });
    },
    onClickdelete: function (event) {
        try {
            var index = event.currentTarget.dataset.index;
            if (index != null && this.data.memoListData != null) {
                this.data.memoListData.splice(event.currentTarget.dataset.index, 1);
                this.setData({
                    memoListData: this.data.memoListData
                });
                wx.setStorageSync('memoListData', this.data.memoListData);
                if (this.data.memoListData.length == 0) {
                    wx.clearStorageSync();
                }
                wx.showToast({
                    title: '删除成功',
                    icon: 'success',
                    duration: 1000
                });
            }
        }
        catch (e) { }
    },
    touchstart: function (event) {
        this.data.memoListData.forEach(function (item) {
            if (item.isTouchMove)
                item.isTouchMove = false;
        });
        this.setData({
            memoListData: this.data.memoListData,
            startX: event.changedTouches[0].clientX,
            startY: event.changedTouches[0].clientY
        });
    },
    touchmove: function (event) {
        var that = this, index = event.currentTarget.dataset.index, startX = that.data.startX, startY = that.data.startY, touchMoveX = event.changedTouches[0].clientX, touchMoveY = event.changedTouches[0].clientY, angle = that.angle({ X: startX, Y: startY }, { X: touchMoveX, Y: touchMoveY });
        that.data.memoListData.forEach(function (v, i) {
            v.isTouchMove = false;
            if (Math.abs(angle) > 30)
                return;
            if (i == index) {
                if (touchMoveX > startX)
                    v.isTouchMove = false;
                else
                    v.isTouchMove = true;
            }
        });
        that.setData({
            memoListData: that.data.memoListData
        });
    },
    angle: function (start, end) {
        var _X = end.X - start.X, _Y = end.Y - start.Y;
        return 360 * Math.atan(_Y / _X) / (2 * Math.PI);
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBRUEsSUFBSSxDQUFDO0lBQ0gsSUFBSSxFQUFFO1FBQ0osVUFBVSxFQUFFLElBQUk7UUFDaEIsWUFBWSxFQUFFLEVBQVc7UUFDekIsUUFBUSxFQUFFLEVBQUU7UUFDWixLQUFLLEVBQUUsQ0FBQztRQUVSLE1BQU0sRUFBRSxDQUFXO1FBQ25CLE1BQU0sRUFBRSxDQUFXO0tBQ3BCO0lBS0QsaUJBQWlCO1FBQ2YsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBQ2hCLEVBQUUsQ0FBQyxtQkFBbUIsQ0FBQztZQUNyQixPQUFPO2dCQUNMLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQztnQkFDcEIsSUFBSSxDQUFDLE9BQVEsQ0FBQztvQkFDWixLQUFLLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLO2lCQUN2QixDQUFDLENBQUM7Z0JBQ0gsSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDO1lBQ3pCLENBQUM7U0FDRixDQUFDLENBQUM7SUFDTCxDQUFDO0lBS0QsYUFBYTtRQUNYLElBQUksWUFBWSxHQUFHLEVBQUUsQ0FBQyxjQUFjLENBQUMsY0FBYyxDQUFDLENBQUM7UUFDckQsSUFBSSxZQUFZLElBQUksSUFBSSxFQUFFO1lBQ3hCLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUU7Z0JBQzFFLEVBQUUsQ0FBQyxTQUFTLENBQUM7b0JBQ1gsS0FBSyxFQUFFLFVBQVU7b0JBQ2pCLElBQUksRUFBRSxNQUFNO29CQUNaLFFBQVEsRUFBRSxJQUFJO2lCQUNmLENBQUMsQ0FBQTthQUNIO2lCQUFNO2dCQUNMLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLENB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dGVudCI6WyIvL2luZGV4LmpzXG5cblBhZ2Uoe1xuICBkYXRhOiB7XG4gICAgaXNOdWxsRGF0YTogdHJ1ZSxcbiAgICBtZW1vTGlzdERhdGE6IFtdIGFzIGFueVtdLFxuICAgIHBhZ2VTaXplOiAyMCxcbiAgICBjb3VudDogMCxcbiAgICAvL+W8gOWni+WdkOagh1xuICAgIHN0YXJ0WDogMCBhcyBudW1iZXIsXG4gICAgc3RhcnRZOiAwIGFzIG51bWJlclxuICB9LFxuXG4gIC8qKlxuICAgKiDpobXpnaLnm7jlhbPkuovku7blpITnkIblh73mlbAtLeebkeWQrOeUqOaIt+S4i+aLieWKqOS9nFxuICAgKi9cbiAgb25QdWxsRG93blJlZnJlc2goKSB7XG4gICAgbGV0IHRoYXQgPSB0aGlzO1xuICAgIHd4LnN0b3BQdWxsRG93blJlZnJlc2goe1xuICAgICAgc3VjY2VzcygpIHtcbiAgICAgICAgdGhhdC5kYXRhLmNvdW50ID0gMDtcbiAgICAgICAgdGhhdC5zZXREYXRhISh7XG4gICAgICAgICAgY291bnQ6IHRoYXQuZGF0YS5jb3VudFxuICAgICAgICB9KTtcbiAgICAgICAgdGhhdC5nZXRNZW1vTGlzdERhdGEoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSxcblxuICAvKipcbiAgICog6aG16Z2i5LiK5ouJ6Kem5bqV5LqL5Lu255qE5aSE55CG5Ye95pWwXG4gICAqL1xuICBvblJlYWNoQm90dG9tKCkge1xuICAgIGxldCBtZW1vTGlzdERhdGEgPSB3eC5nZXRTdG9yYWdlU3luYygnbWVtb0xpc3REYXRhJyk7XG4gICAgaWYgKG1lbW9MaXN0RGF0YSAhPSBudWxsKSB7XG4gICAgICBpZiAodGhpcy5kYXRhLmNvdW50ID09IE1hdGguY2VpbChtZW1vTGlzdERhdGEubGVuZ3RoIC8gdGhpcy5kYXRhLnBhZ2VTaXplKSkge1xuICAgICAgICB3eC5zaG93VG9hc3Qoe1xuICAgICAgICAgIHRpdGxlOiAn5rKh5pyJ5pu05aSa5pWw5o2u5LqG77yBJyxcbiAgICAgICAgICBpY29uOiAnbm9uZScsXG4gICAgICAgICAgZHVyYXRpb246IDE1MDBcbiAgICAgICAgfSlcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuZGF0YS5jb3VudCsrO1xuICAgICAgICB0aGlzLmdldE1lbW9MaXN0RGF0YSgpO1xuICAgICAgfVxuICAgIH1cblxuICB9LFxuXG4gIC8qKlxuICAgKiDnlJ/lkb3lkajmnJ/lh73mlbAtLeebkeWQrOmhtemdouaYvuekulxuICAgKi9cbiAgb25TaG93KCkge1xuICAgIHRyeSB7XG4gICAgICB0aGlzLmRhdGEuY291bnQgPSAwO1xuICAgICAgdGhpcy5zZXREYXRhISh7XG4gICAgICAgIGNvdW50OiB0aGlzLmRhdGEuY291bnRcbiAgICAgIH0pO1xuICAgICAgdGhpcy5nZXRNZW1vTGlzdERhdGEoKTtcbiAgICAgIC8vIOiuvue9rue8lui+keeKtuaAgVxuICAgICAgd3guc2V0U3RvcmFnZVN5bmMoJ2lzRWRpdCcsIGZhbHNlKVxuICAgIH0gY2F0Y2ggKGUpIHsgfVxuICB9LFxuXG4gIG9uTG9hZCgpIHtcbiAgICB0aGlzLmRhdGEuY291bnQgPSAwO1xuICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgY291bnQ6IHRoaXMuZGF0YS5jb3VudFxuICAgIH0pO1xuICAgIHRoaXMuZ2V0TWVtb0xpc3REYXRhKCk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIOiOt+WPluWkh+W/mOW9leaVsOaNrua6kFxuICAgKi9cbiAgZ2V0TWVtb0xpc3REYXRhKCkge1xuICAgIC8vIOiOt+WPluacrOWcsOe8k+WtmOWkh+W/mOW9leWIl+ihqOaVsOaNrlxuICAgIHRyeSB7XG4gICAgICBsZXQgbWVtb0xpc3REYXRhID0gd3guZ2V0U3RvcmFnZVN5bmMoJ21lbW9MaXN0RGF0YScpO1xuICAgICAgaWYgKG1lbW9MaXN0RGF0YSkge1xuICAgICAgICBtZW1vTGlzdERhdGEuZm9yRWFjaCgoaXRlbTogYW55KSA9PiB7XG4gICAgICAgICAgLy/pu5jorqTpmpDol4/liKDpmaRcbiAgICAgICAgICBpdGVtLmlzVG91Y2hNb3ZlID0gZmFsc2U7XG4gICAgICAgIH0pO1xuICAgICAgICAvLyDliIbpobVcbiAgICAgICAgbGV0IG1lbW9MaXN0RGF0YVRlbXA6IGFueVtdID0gW107XG4gICAgICAgIGxldCB0b3RhbCA9IG1lbW9MaXN0RGF0YS5sZW5ndGg7XG4gICAgICAgIGxldCBwYWdlTnVtID0gKHRoaXMuZGF0YS5jb3VudCArIDEpICogdGhpcy5kYXRhLnBhZ2VTaXplO1xuICAgICAgICBpZiAocGFnZU51bSA+IHRvdGFsKSB7XG4gICAgICAgICAgcGFnZU51bSA9IHRvdGFsO1xuICAgICAgICAgIHRoaXMuZGF0YS5jb3VudCA9IE1hdGguY2VpbCh0b3RhbCAvIHRoaXMuZGF0YS5wYWdlU2l6ZSk7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwYWdlTnVtOyBpKyspIHtcbiAgICAgICAgICBtZW1vTGlzdERhdGFUZW1wLnB1c2gobWVtb0xpc3REYXRhW2ldKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgICAgICBjb3VudDogdGhpcy5kYXRhLmNvdW50LFxuICAgICAgICAgIG1lbW9MaXN0RGF0YTogbWVtb0xpc3REYXRhVGVtcCxcbiAgICAgICAgICBpc051bGxEYXRhOiBmYWxzZVxuICAgICAgICB9KVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5zZXREYXRhISh7XG4gICAgICAgICAgbWVtb0xpc3REYXRhOiBbXSBhcyBhbnksXG4gICAgICAgICAgaXNOdWxsRGF0YTogdHJ1ZVxuICAgICAgICB9KVxuICAgICAgfVxuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIHd4LnNob3dUb2FzdCh7XG4gICAgICAgIHRpdGxlOiAn6I635Y+W5aSH5b+Y5b2V5pWw5o2u5aSx6LSl77yM6K+356iN5ZCO5YaN6K+V77yBJyxcbiAgICAgICAgaWNvbjogJ25vbmUnLFxuICAgICAgICBkdXJhdGlvbjogMTUwMFxuICAgICAgfSlcbiAgICB9XG4gIH0sXG5cbiAgLyoqXG4gICAqIOeCueWHu+aWsOW7ulxuICAgKi9cbiAgb25DbGlja05ldygpIHtcbiAgICB0cnkge1xuICAgICAgLy8g6K6+572u57yW6L6R54q25oCBXG4gICAgICB3eC5zZXRTdG9yYWdlU3luYygnaXNFZGl0JywgZmFsc2UpXG4gICAgICAvLyDliIfmjaLliLDmlrDlu7pcbiAgICAgIHd4LnN3aXRjaFRhYih7XG4gICAgICAgIHVybDogJy9wYWdlcy9uZXcvbmV3J1xuICAgICAgfSlcbiAgICB9IGNhdGNoIChlKSB7IH1cbiAgfSxcblxuICAvKipcbiAgICog54K55Ye757yW6L6RXG4gICAqL1xuICBvbkNsaWNrRWRpdChldmVudDogYW55KSB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIOiuvue9rue8lui+keeKtuaAgVxuICAgICAgd3guc2V0U3RvcmFnZVN5bmMoJ2lzRWRpdCcsIHRydWUpXG4gICAgICBsZXQgaWQgPSBldmVudC5jdXJyZW50VGFyZ2V0LmRhdGFzZXQuaXRlbS5pZDtcbiAgICAgIC8vIOiuvue9rklkXG4gICAgICB3eC5zZXRTdG9yYWdlU3luYygnaWQnLCBpZClcbiAgICAgIC8vIOWIh+aNouWIsOaWsOW7ulxuICAgICAgd3guc3dpdGNoVGFiKHtcbiAgICAgICAgdXJsOiAnL3BhZ2VzL25ldy9uZXcnXG4gICAgICB9KVxuICAgIH0gY2F0Y2ggKGUpIHsgfVxuICB9LFxuXG4gIC8qKlxuICAgKiDliKDpmaTmj5DnpLpcbiAgICovXG4gIG9uQ2xpY2tkZWxldGVNb2RhbChldmVudDogYW55KSB7XG4gICAgbGV0IHRoYXQgPSB0aGlzO1xuICAgIHd4LnNob3dNb2RhbCh7XG4gICAgICB0aXRsZTogJ+WIoOmZpOaPkOekuicsXG4gICAgICBjb250ZW50OiAn5piv5ZCm56Gu5a6a5Yig6Zmk6K+l5aSH5b+Y5b2V77yBJyxcbiAgICAgIHN1Y2Nlc3MocmVzKSB7XG4gICAgICAgIGlmIChyZXMuY29uZmlybSkge1xuICAgICAgICAgIHRoYXQub25DbGlja2RlbGV0ZShldmVudCk7XG4gICAgICAgIH0gZWxzZSBpZiAocmVzLmNhbmNlbCkge1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSlcbiAgfSxcblxuICAvKipcbiAgICog54K55Ye75Yig6ZmkXG4gICAqL1xuICBvbkNsaWNrZGVsZXRlKGV2ZW50OiBhbnkpIHtcbiAgICB0cnkge1xuICAgICAgbGV0IGluZGV4OiBudW1iZXIgPSBldmVudC5jdXJyZW50VGFyZ2V0LmRhdGFzZXQuaW5kZXg7XG4gICAgICBpZiAoaW5kZXggIT0gbnVsbCAmJiB0aGlzLmRhdGEubWVtb0xpc3REYXRhICE9IG51bGwpIHtcbiAgICAgICAgdGhpcy5kYXRhLm1lbW9MaXN0RGF0YS5zcGxpY2UoZXZlbnQuY3VycmVudFRhcmdldC5kYXRhc2V0LmluZGV4LCAxKTtcbiAgICAgICAgdGhpcy5zZXREYXRhISh7XG4gICAgICAgICAgbWVtb0xpc3REYXRhOiB0aGlzLmRhdGEubWVtb0xpc3REYXRhXG4gICAgICAgIH0pXG4gICAgICAgIC8v5byC5q2l5pu05paw5YiX6KGo57yT5a2YXG4gICAgICAgIHd4LnNldFN0b3JhZ2VTeW5jKCdtZW1vTGlzdERhdGEnLCB0aGlzLmRhdGEubWVtb0xpc3REYXRhKTtcbiAgICAgICAgaWYgKHRoaXMuZGF0YS5tZW1vTGlzdERhdGEubGVuZ3RoID09IDApIHtcbiAgICAgICAgICB3eC5jbGVhclN0b3JhZ2VTeW5jKCk7XG4gICAgICAgIH1cbiAgICAgICAgd3guc2hvd1RvYXN0KHtcbiAgICAgICAgICB0aXRsZTogJ+WIoOmZpOaIkOWKnycsXG4gICAgICAgICAgaWNvbjogJ3N1Y2Nlc3MnLFxuICAgICAgICAgIGR1cmF0aW9uOiAxMDAwXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGUpIHsgfVxuICB9LFxuXG4gIC8qKlxuICAgKiDmiYvmjIfop6bmkbjliqjkvZzlvIDlp4sg6K6w5b2V6LW354K5WOWdkOagh1xuICAgKi9cbiAgdG91Y2hzdGFydChldmVudDogYW55KSB7XG4gICAgLy/lvIDlp4vop6bmkbjml7Yg6YeN572u5omA5pyJ5Yig6ZmkXG4gICAgdGhpcy5kYXRhLm1lbW9MaXN0RGF0YS5mb3JFYWNoKChpdGVtOiBhbnkpID0+IHtcbiAgICAgIC8v5Y+q5pON5L2c5Li6dHJ1ZeeahFxuICAgICAgaWYgKGl0ZW0uaXNUb3VjaE1vdmUpXG4gICAgICAgIGl0ZW0uaXNUb3VjaE1vdmUgPSBmYWxzZTtcbiAgICB9KTtcbiAgICAvL+abtOaWsOaVsOaNrlxuICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgbWVtb0xpc3REYXRhOiB0aGlzLmRhdGEubWVtb0xpc3REYXRhLFxuICAgICAgc3RhcnRYOiBldmVudC5jaGFuZ2VkVG91Y2hlc1swXS5jbGllbnRYLFxuICAgICAgc3RhcnRZOiBldmVudC5jaGFuZ2VkVG91Y2hlc1swXS5jbGllbnRZXG4gICAgfSlcbiAgfSxcblxuICAvKipcbiAgICog5ruR5Yqo5LqL5Lu25aSE55CGXG4gICAqL1xuICB0b3VjaG1vdmUoZXZlbnQ6IGFueSkge1xuICAgIGxldCB0aGF0ID0gdGhpcyxcbiAgICAgIGluZGV4ID0gZXZlbnQuY3VycmVudFRhcmdldC5kYXRhc2V0LmluZGV4LC8v5b2T5YmN57Si5byVXG4gICAgICBzdGFydFggPSB0aGF0LmRhdGEuc3RhcnRYLC8v5byA5aeLWOWdkOagh1xuICAgICAgc3RhcnRZID0gdGhhdC5kYXRhLnN0YXJ0WSwvL+W8gOWni1nlnZDmoIdcbiAgICAgIHRvdWNoTW92ZVggPSBldmVudC5jaGFuZ2VkVG91Y2hlc1swXS5jbGllbnRYLC8v5ruR5Yqo5Y+Y5YyW5Z2Q5qCHXG4gICAgICB0b3VjaE1vdmVZID0gZXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0uY2xpZW50WSwvL+a7keWKqOWPmOWMluWdkOagh1xuICAgICAgLy/ojrflj5bmu5Hliqjop5LluqZcbiAgICAgIGFuZ2xlID0gdGhhdC5hbmdsZSh7IFg6IHN0YXJ0WCwgWTogc3RhcnRZIH0sIHsgWDogdG91Y2hNb3ZlWCwgWTogdG91Y2hNb3ZlWSB9KTtcblxuICAgIHRoYXQuZGF0YS5tZW1vTGlzdERhdGEuZm9yRWFjaCgodjogYW55LCBpOiBudW1iZXIpID0+IHtcbiAgICAgIHYuaXNUb3VjaE1vdmUgPSBmYWxzZVxuICAgICAgLy/mu5HliqjotoXov4czMOW6puinkiByZXR1cm5cbiAgICAgIGlmIChNYXRoLmFicyhhbmdsZSkgPiAzMCkgcmV0dXJuO1xuICAgICAgaWYgKGkgPT0gaW5kZXgpIHtcbiAgICAgICAgaWYgKHRvdWNoTW92ZVggPiBzdGFydFgpIC8v5Y+z5ruRXG4gICAgICAgICAgdi5pc1RvdWNoTW92ZSA9IGZhbHNlXG4gICAgICAgIGVsc2UgLy/lt6bmu5FcbiAgICAgICAgICB2LmlzVG91Y2hNb3ZlID0gdHJ1ZVxuICAgICAgfVxuICAgIH0pO1xuICAgIC8v5pu05paw5pWw5o2uXG4gICAgdGhhdC5zZXREYXRhISh7XG4gICAgICBtZW1vTGlzdERhdGE6IHRoYXQuZGF0YS5tZW1vTGlzdERhdGFcbiAgICB9KVxuICB9LFxuXG4gIC8qKlxuICAgKiDorqHnrpfmu5Hliqjop5LluqZcbiAgICovXG4gIGFuZ2xlKHN0YXJ0OiBhbnksIGVuZDogYW55KSB7XG4gICAgbGV0IF9YID0gZW5kLlggLSBzdGFydC5YLCBfWSA9IGVuZC5ZIC0gc3RhcnQuWVxuICAgIC8v6L+U5Zue6KeS5bqmIE1hdGguYXRhbigp6L+U5Zue5pWw5a2X55qE5Y+N5q2j5YiH5YC8XG4gICAgcmV0dXJuIDM2MCAqIE1hdGguYXRhbihfWSAvIF9YKSAvICgyICogTWF0aC5QSSk7XG4gIH1cblxufSlcbiJdfQ==